---
// 开屏动画组件
// 在首次进入或刷新页面时显示Welcome动画
---

<div id="splash-screen" class="splash-screen">
	<div class="splash-content">
		<div class="welcome-text">Welcome</div>
	</div>
</div>

<script>
	(function () {
		const screenEl = document.getElementById('splash-screen');
		if (!screenEl) {
			document.body.classList.add('page-ready');
			return;
		}
		const splashScreen = screenEl;

		const MIN_DISPLAY_TIME = 1500; // 最小显示时长（毫秒）
		const FADE_OUT_DURATION = 300; // 淡出动画时长（毫秒）

		// 禁止页面滚动
		document.body.style.overflow = 'hidden';
		document.documentElement.style.overflow = 'hidden';

		// 阻止滚动事件
		function preventScroll(e: Event) {
			e.preventDefault();
		}

		// 阻止各种滚动方式
		window.addEventListener('wheel', preventScroll, { passive: false });
		window.addEventListener('touchmove', preventScroll, { passive: false });
		window.addEventListener('scroll', preventScroll, { passive: false });

		let pageLoaded = false;
		const startTime = Date.now();
		let hideTimeout = 0;

		function hideSplash() {
			if (hideTimeout) return; // 防止重复调用

			splashScreen.classList.add('fade-out');
			
			hideTimeout = window.setTimeout(() => {
				splashScreen.style.display = 'none';
				document.body.classList.add('page-ready');
				const siteShell = document.querySelector('.site-shell');
				if (siteShell) {
					(siteShell as HTMLElement).setAttribute('aria-hidden', 'false');
				}
				// 恢复页面滚动
				document.body.style.overflow = '';
				document.documentElement.style.overflow = '';
				// 移除滚动事件阻止
				window.removeEventListener('wheel', preventScroll);
				window.removeEventListener('touchmove', preventScroll);
				window.removeEventListener('scroll', preventScroll);
			}, FADE_OUT_DURATION);
		}

		function tryHide() {
			const elapsed = Date.now() - startTime;
			if (pageLoaded && elapsed >= MIN_DISPLAY_TIME) {
				hideSplash();
			}
		}

		// 监听页面加载完成
		window.addEventListener('load', () => {
			pageLoaded = true;
			tryHide();
		});

		// 如果页面已经加载完成（回访用户）
		if (document.readyState === 'complete') {
			pageLoaded = true;
			tryHide();
		}

		// 确保最小显示时长
		window.setTimeout(() => {
			tryHide();
		}, MIN_DISPLAY_TIME);
	})();
</script>

<style>
	.splash-screen {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: #ffffff;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 9999;
		animation: backgroundFadeIn 0.2s ease-out;
	}

	.splash-content {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.welcome-text {
		font-size: 4rem;
		font-weight: 300;
		letter-spacing: 0.2em;
		color: #1a1a1a;
		animation: welcomeFadeIn 1.5s ease-in-out forwards;
		text-transform: uppercase;
	}

	.splash-screen.fade-out {
		animation: fadeOut 0.3s ease-out forwards;
	}

	.splash-screen.fade-out .welcome-text {
		opacity: 0;
		animation: none;
	}

	@keyframes backgroundFadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	@keyframes welcomeFadeIn {
		0% {
			opacity: 0;
		}
		50% {
			opacity: 1;
		}
		100% {
			opacity: 0;
		}
	}

	@keyframes fadeOut {
		from {
			opacity: 1;
		}
		to {
			opacity: 0;
		}
	}

	/* 响应式设计 */
	@media (max-width: 768px) {
		.welcome-text {
			font-size: 2.5rem;
			letter-spacing: 0.15em;
		}
	}

	@media (max-width: 480px) {
		.welcome-text {
			font-size: 2rem;
			letter-spacing: 0.1em;
		}
	}
</style>

